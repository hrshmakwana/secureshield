{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4">Dashboard</h2>
<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <p class="text-muted mb-1">Monitored Files</p>
          <h3>{{ file_count }}</h3>
        </div>
        <div class="badge bg-primary">Files</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <p class="text-muted mb-1">Modified Alerts</p>
          <h3 class="text-danger">{{ modified_count }}</h3>
        </div>
        <div class="badge bg-danger">Alerts</div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card p-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <p class="text-muted mb-1">Total Scans</p>
          <h3>{{ scan_count }}</h3>
        </div>
        <div class="badge bg-success">Scans</div>
      </div>
    </div>
  </div>
</div>
<div class="row g-3">
  <div class="col-md-6">
    <div class="card p-3 h-100">
      <h5>Recent Scans</h5>
      <table class="table table-sm table-dark align-middle">
        <thead>
          <tr><th>URL</th><th>Severity</th><th>Date</th></tr>
        </thead>
        <tbody>
        {% for scan in recent_scans %}
          <tr>
            <td class="text-truncate" style="max-width: 220px;">{{ scan.target_url }}</td>
            <td><span class="badge {% if scan.severity=='High' %}bg-danger{% elif scan.severity=='Medium' %}bg-warning{% else %}bg-success{% endif %}">{{ scan.severity }}</span></td>
            <td>{{ scan.scan_date.strftime('%Y-%m-%d') }}</td>
          </tr>
        {% else %}
          <tr><td colspan="3" class="text-muted">No scans yet.</td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card p-3 h-100">
      <h5>Security Overview</h5>
      <canvas id="overviewChart" height="180"></canvas>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const ctx = document.getElementById('overviewChart');
    if (!ctx) return;
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Safe Files', 'Modified', 'Scans'],
        datasets: [{
          data: [{{ file_count - modified_count }}, {{ modified_count }}, {{ scan_count }}],
          backgroundColor: ['#22c55e', '#ef4444', '#3b82f6'],
        }]
      },
      options: { plugins: { legend: { labels: { color: '#e6e9ef' } } } }
    });
  });
</script>
{% endblock %}
