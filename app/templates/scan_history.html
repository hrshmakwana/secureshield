{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Scan History</h3>
  <form class="d-flex" method="GET" action="{{ url_for('scan.history') }}">
    <input type="search" class="form-control me-2" name="q" value="{{ search }}" placeholder="Filter by URL">
    <button class="btn btn-outline-light" type="submit">Search</button>
  </form>
</div>
<div class="card p-3">
  <table class="table table-dark align-middle">
    <thead><tr><th>Target URL</th><th>SQLi</th><th>XSS</th><th>Severity</th><th>Date</th><th></th></tr></thead>
    <tbody>
      {% for scan in pagination.items %}
      <tr>
        <td class="text-truncate" style="max-width: 240px;">{{ scan.target_url }}</td>
        <td><span class="badge {% if scan.sqli_result %}bg-danger{% else %}bg-success{% endif %}">{{ 'Yes' if scan.sqli_result else 'No' }}</span></td>
        <td><span class="badge {% if scan.xss_result %}bg-danger{% else %}bg-success{% endif %}">{{ 'Yes' if scan.xss_result else 'No' }}</span></td>
        <td><span class="badge {% if scan.severity=='High' %}bg-danger{% elif scan.severity=='Medium' %}bg-warning{% else %}bg-success{% endif %}">{{ scan.severity }}</span></td>
        <td>{{ scan.scan_date.strftime('%Y-%m-%d') }}</td>
        <td><a class="btn btn-sm btn-primary" href="{{ url_for('scan.download_report', scan_id=scan.id) }}">Report</a></td>
      </tr>
      {% else %}
      <tr><td colspan="6" class="text-muted">No scans recorded.</td></tr>
      {% endfor %}
    </tbody>
  </table>
  <nav>
    <ul class="pagination justify-content-end">
      {% if pagination.has_prev %}
      <li class="page-item"><a class="page-link" href="{{ url_for('scan.history', page=pagination.prev_num, q=search) }}">Previous</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">Page {{ pagination.page }} of {{ pagination.pages }}</span></li>
      {% if pagination.has_next %}
      <li class="page-item"><a class="page-link" href="{{ url_for('scan.history', page=pagination.next_num, q=search) }}">Next</a></li>
      {% else %}
      <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
